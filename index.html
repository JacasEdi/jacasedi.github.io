<!DOCTYPE html>
<html>
<body>
<span style="font-size:32px;font-weight:bold;">Bath water level monitoring system using Arduino and Android device</span>
<h1>Overview</h1><p>
This article is intended to serve as a guide for anyone interested in electronics, IoT and/or home automation. The purpose of it is to introduce and provide a high-level overview of the technical project, outcome of which is going to be a <i>bath monitoring system</i> comprised of Arduino Uno and Android mobile device. It explains the idea behind the project, as well as the components required for the implementation and how to transfer data between Arduino and Android devices.&nbsp;It will allow the user to keep track of how full his/her bath is at any given point, and send alerts via both Arduino and mobile device as the water level starts to get close to the maximum specified by the user. Diagrams and tables are provided to help the reader understand the more complex areas, and hyperlinks to some external resources are included where a more in-depth explanation of corresponding topics can be found. Due to the prototype nature of this project and hardware limitations, small plastic container could be used to demonstrate its capabilities rather than real, full-scale bath.<br><br><img src="https://moodle.napier.ac.uk/draftfile.php/981588/user/draft/514952564/bath.jpg" alt="bath" width="473" height="300" class="img-responsive atto_image_button_left"><img src="https://moodle.napier.ac.uk/draftfile.php/981588/user/draft/514952564/phone.jpg" alt="phone" width="436" height="300" class="img-responsive atto_image_button_left"><img src="https://moodle.napier.ac.uk/draftfile.php/981588/user/draft/514952564/arduino.png" alt="arduino" width="414" height="300" class="img-responsive atto_image_button_left"></p><p><br></p><div style="clear:both;"><br><br><h1>Main components</h1><p>There are two main components to this project, and each of them has subcomponents of its own that are required for the successful implementation:</p><p></p><ul><li><b>Arduino Uno</b></li></ul>Arduino is an open-source platform that consists of programmable circuit board, which is known as the <a href="http://www.futureelectronics.com/en/Microcontrollers/microcontrollers.aspx" style="color:#0033FF;">microcontroller</a>,&nbsp;and an&nbsp;<a href="https://en.wikipedia.org/wiki/Integrated_development_environment" style="color:#0033FF;">IDE</a> (Integrated Development Environment), which is a software application that includes source code editor and build tools and is used to upload program to the board. As for IDEs to write and compile your code in, there is plenty options available, one of which is a dedicated Arduino IDE provided by the manufacturer. Other IDEs that can be used with Arduino include Visual Studio (requires&nbsp;<a href="https://marketplace.visualstudio.com/items?itemName=VisualMicro.ArduinoIDEforVisualStudio" style="color:#0033FF;">Visual Micro</a> extension), <a href="https://www.eclipse.org/downloads/" style="color:#0033FF;">Eclipse</a>, and many other - full list of which can be found <a href="https://playground.arduino.cc/Main/DevelopmentTools" style="color:#0033FF;">here</a> on the official website. Similarly for the microcontroller, or the physical hardware component, there are various options available - you can either buy a more expensive official Arduino board directly from the manufacturer or one of approved resellers, or get a cheaper <i>clone</i> that provides same functionality and compatibility.<br><br>Whatever the choice, board by itself is of not much use without additional components that can be connected to it. There are thousands of different components that can be purchased online, and many manufacturers bundle some of them together with the board to create kits, which vary in price, number of items, and their complexity to target both beginners and more experienced Arduino enthusiasts. Below is a list of components that are essential for the project described in this article:<br><br><ul><li><b>Breadboard</b> - a construction base used for electronic prototyping. It allows to easily create electrical circuits by inserting jumper wires into appropriate connection points on the board without the need for soldering. Breadboards vary in their size - miniature versions can have as little as 170 tie points (they do not have bus strips which supply power across the rows), whereas full size version has 830 tie points and bus strips for <i>ground</i> and <i>power </i>along both sides of the board.</li><li><b>LED</b><b>s</b> - Light Emitting Diode is a type of diode that glows as electricity passes through it. LEDs come in range of colours - most common ones being red, green and blue.</li><li><b>Buzzer</b> - an audio signalling device for generating various sounds - often used for alarms, for example timers and clocks. There are two types of buzzers: active and passive. Active buzzer has a built-in oscillating source, and applying DC voltage to it is enough to make it generate a tone. Passive buzzer, however, does not have such internal source of sound, so supplying a fixed voltage to it will not cause it to make noise. Instead, it is the Arduino itself that has to generate sound through something called <a href="https://www.allaboutcircuits.com/textbook/alternating-current/chpt-7/square-wave-signals/" style="color:#0033FF;">square waves</a>. This technique makes it possible to produce different tones, whereas Active buzzer is limited to only one type of sound.</li><li><b>Jumper wires</b> - a short insulated wires, both ends of which are stripped of the insulation. Jumper wires are essential component of nearly every project that involves Arduino and electronics. They are used to connect one of Arduino pins to a breadboard, or two points in a breadboard circuit itself.</li><li><b>Resistors</b> - as their name suggests, resistors <i>resist</i>&nbsp;the flow of electricity. The unit, or measure, of resistance is known as Ohm. The higher Ohm value (these are often denoted in thousands - kilo-ohms, or milions - mega-ohms, as smaller values offer very little resistance), the more it resists and therefore less electrical current can flow through it.</li><li><b>Water level sensor</b> - used to indicate the level of water in a tank. Since water acts as a conductor, this type of sensor can be used to detect the level of it inside a tank, and send this value back to Arduino. The more of sensor's surface is covered in water, the higher reading value it will return. It is worth noting at this point that most water level sensors, such as <a href="https://hobbyking.com/en_us/water-sensor-module-for-arduino.html?countrycode=GB&amp;gclid=CjwKCAiA24PVBRBvEiwAyBxf-X26ud4tCGarFLbfcKZdrrDPrEziHt-ULTD8O3di-HI3FxyWRQ55uhoCP-UQAvD_BwE&amp;gclsrc=aw.ds&amp;___store=en_us" style="color:#0033FF;">this one</a>, will return an analog value between 0 and 1024. This value does not directly relate to the capacity of the container (bath), so it would have to be converted to percentage based on how much water it can hold.</li><li><b>LCD screen</b> - LCD is a short for liquid crystal display. This component is a simple screen that can be used to display alphanumeric text such as sensor readings, prompts, warnings - all kinds of information. It can be connected to the breadboard using jumper wires, and is often used together with potentiometer.</li><li><b>Potentiometer</b> - a type of variable resistor. It can be manually adjusted using a knob to change the resistance value. When used in conjunction with LCD, potentiometer makes it possible to change the contrast of the screen by controlling how much electrical current is allowed to flow through it - the more we twist the knob to the left, the brighter text will be, whereas twisting it to the right will make it darker, i.e. more visible.</li><li><b>Bluetooth module</b>&nbsp;- allows for wireless connection between Arduino and other Bluetooth-enabled devices. <i><a href="https://www.banggood.com/HC-06-Wireless-Bluetooth-Transceiver-RF-Main-Module-Serial-For-Arduino-p-80364.html?rmmds=buy&amp;cur_warehouse=CN" style="color:#0033FF;">HC-06</a> </i>is one example of such module. It is inexpensive and can be purchased from number of online retailers,. It is also very easy to set up and provides reliable connection, which fits all criteria of this project.</li></ul><br><ul><li><b>Android mobile device</b></li></ul>Second main part of this project involves the use of an Android-based mobile device. Its main purpose will be to receive data from Arduino and its sensors, process it accordingly and display notifications to the user. This includes both graphical communication, such as through on-screen alerts and displaying current water level in the bath (tank), but also audio signals, specifically different kinds of alerts as the water fills the bath and gets closer to the maximum capacity or desired level. This requires a dedicated mobile application to be created, which will act as an interface between the mobile device and Arduino to allow these hardware components to communicate (this aspect is explained in the&nbsp;<i>Communication between the devices</i>&nbsp;<i>s</i>ection that follows). There are no additional hardware requirements on the <span>"mobile side" of the project, other than it must have a fully functional, built-in Bluetooth module - which is the case with each and every modern Android smartphone or tablet, and can be easily verified in device settings.</span><br><br><h1>Communication between the devices</h1><p>As mentioned in the previous section, an external Bluetooth module is required for Arduino to allow it to send and receive data wirelessly. It only requires four jumper wires to connect it to the board, as seen in the diagram below. In most projects, however, you would not connect the <i>Power </i>pins directly to Arduino Uno (black and red wires in this example, which is no coincidence - using colour coding is a good practice that helps prevent potential damage to the components and USB port), but instead to appropriate points on the breadboard which have been passed the electric current via adjacent bus strips. Other Bluetooth modules may need to be connected in a different way, so it is important to always check their respective specifications and dedicated guides.</p><p><img src="https://moodle.napier.ac.uk/draftfile.php/981588/user/draft/514952564/hc06%20arduino%20uno%20connection.png" alt="hc06 arduino uno connection" width="762" height="450" class="img-responsive atto_image_button_text-bottom"><br></p><p><br></p><p>Pairing HC-06 that has been correctly attached to Arduino with an Android device is even easier. Once it is up and running, it should be listed under <i>Available devices</i>&nbsp;in the&nbsp;<i>Bluetooth</i>&nbsp;<span>section of the <i>Settings </i>app.<i>&nbsp;</i>First time you try to pair with it, you will need to enter PIN, default value for which is "1234". Defaults can be changed using <a href="http://www.instructables.com/id/AT-command-mode-of-HC-05-Bluetooth-module/" style="color:#0033FF;">AT Commands</a> - these, however, are beyond the scope of this project.</span></p><p><img src="https://moodle.napier.ac.uk/draftfile.php/981588/user/draft/514952564/android%20bluetooth%20hc06.jpg" alt="android bluetooth pairing hc06" width="400" height="604" class="img-responsive atto_image_button_text-bottom"><br></p><p>At this point Arduino should be able to both send and receive data from the Android device. It will allow us to program the board to send the water level sensor readings at regular intervals, and they can then be used in our mobile application to calculate the percentage of how full the bath, or tank, currently is, and display that information in a user-friendly form.</p><p>Obviously no data can be transferred over Bluetooth without software that will handle those tasks - this applies to both Arduino and Android. The following table provides overview of how this can be achieved on each of those platforms:</p>
<table style="table-layout:fixed;width:100%;border:1px solid #000000;"><caption style="caption-side:bottom;"><span style="font-size:small;">Transferring data via Bluetooth - Arduino &amp; Android implementations</span></caption>
<thead><tr style="border:1px solid #000000;"><th scope="col" style="border:1px solid #000000;">Platform</th>
<th scope="col" style="border:1px solid #000000;">Arduino</th>
<th scope="col" style="border:1px solid #000000;">Android</th>
</tr></thead><tbody><tr style="border:1px solid #000000;"><td style="border:1px solid #000000;"><b>Library name</b></td>
<td style="border:1px solid #000000;">SoftwareSerial</td>
<td style="border:1px solid #000000;">android.bluetooth</td>
</tr></tbody><tbody><tr style="border:1px solid #000000;"><td style="border:1px solid #000000;"><b>Provider</b></td>
<td style="border:1px solid #000000;">Arduino</td>
<td style="border:1px solid #000000;">Android</td>
</tr></tbody><tbody><tr style="border:1px solid #000000;"><td style="border:1px solid #000000;"><b>Library reference URL</b></td>
<td style="border:1px solid #000000;"><a href="https://www.arduino.cc/en/Reference/SoftwareSerial" style="color:#0033FF;">https://www.arduino.cc/en/Reference/SoftwareSerial</a></td>
<td style="border:1px solid #000000;"><a href="https://developer.android.com/guide/topics/connectivity/bluetooth.html" style="color:#0033FF;">https://developer.android.com/guide/topics/connectivity/bluetooth.html</a></td>
</tr><tr style="border:1px solid #000000;"><td style="border:1px solid #000000;"><b>Important methods &amp; classes</b></td>
<td style="border:1px solid #000000;vertical-align:top;"><i>begin()</i>&nbsp;- sets the speed (baud rate) for the serial communication. It takes any valid baud rate value as a parameter, most commonly "9600".&nbsp;<br><br><i>println()</i>&nbsp;- prints data to the serial port as human-readable ASCII text followed by a carriage return character (ASCII 13, or '\r') and a newline character (ASCII 10, or '\n'). This is the method we should be using to send sensor readings and other data in a form of text from Arduino to Android device.<br><br><i>available()</i> - gets the number of characters available for reading from a software serial port. This is data that has already arrived from another device Arduino is connecting to via Bluetooth and stored in the serial receive buffer.<br><br><i>read()</i>&nbsp;- returns a character that was received on the RX (Receive) pin of the software serial port. Although not a concern for this project, it is important to know that only one SoftwareSerial instance can receive incoming data at a time, so if we were using multiple ports&nbsp;to receive data from two or more sources, we would have to select one of them using listen() function before reading this data.<br><br><br></td>
<td style="border:1px solid #000000;"><i>BluetoothAdapter</i> - a class that represents the local device's Bluetooth adapter (if present).&nbsp;<i>getDefaultAdapter()</i> method should be called to get an instance of BluetoothAdapter, which can then be used to discover other devices, query a list of paired devices, and more.<br><br><i>BluetoothDevice</i>&nbsp;- this class represents a remote Bluetooth device, such as Arduino Uno. A BluetoothDevice lets you create a connection with the respective device or query information about it, such as the name, address, class, and bonding (pairing) state. All devices that have previously been paired can be easily obtained using&nbsp;<i>getBondedDevices() </i>method that returns a set of BluetoothDevice objects.<br><br><i>BluetoothSocket</i> - an instance of this class allows to connect and exchange data between the Android device and some other remote device represented by the BluetoothDevice object.<br><br><i>InputStream</i> - once a Bluetooth connection between the devices has been established by a BluetoothSocket object, it can be used to set up an <i>InputStream</i> via <i>getInputStream()</i> method of this class. A dedicated thread will then constantly listen for any incoming data, which will initially be placed in a buffer using <i>read()</i>&nbsp;method of the InputStream class before being used elsewhere in the program, for example displayed on the screen.<br><br><i>OutputStream</i>&nbsp;- similarly to the InputStream, an OutputStream can be instantiated via BluetoothSocket's <i>getOutputStream() </i>method. Data can then be send to a remote device connected through the socket using the <i>write()</i> method that takes an array of bytes (characters) to be send as its parameter.<br><br><br></td></tr></tbody></table><br><br><h1>Potential implementation</h1><p>Potential implementation of this project can be described using a following simplified sequence of actions:</p><p></p><ol><li>Water fills the bath and reaches the surface of the water level sensor.</li><li>Sensor starts to record the water level as it raises and sends it to Arduino board via jumpers wires and pins they are connected to.</li><li>Arduino passes those readings to LCD via appropriate digital ports on the board. Readings are then displayed on the screen.</li><li>Arduino also sends those readings to a mobile device it is connected to via Bluetooth. Specifically, it would use the the TXD port (<i>hc06 arduino uno connection </i>diagram in the previous section) to send those readings to a Bluetooth module connected to the board, which would then transfer them to a paired device using <a href="http://www.ladyada.net/learn/arduino/lesson4.html" style="color:#0033FF;">Serial Transmission</a> (a bit at a time, one right after the other).</li><li>Mobile device listens for the upcoming data and receives the readings.</li><li>Readings are converted to a percentage of the highest possible value and displayed on the screen inside the mobile application.</li><li>Once 50% of the sensor is covered in water, blue LED on Arduino flashes, and both Arduino buzzer and mobile device make a single beep.</li><li>Once 75% of the sensor is covered in water, yellow LED on Arduino flashes, and both Arduino buzzer and mobile device make a double beep.</li><li>Once 100% of the sensor is covered in water, red LED on Arduino flashes, LED light on the mobile device flashes, and both Arduino buzzer and smartphone/tablet speaker make a constant high-pitched sound.</li></ol><p>This is just an overview of one of the potential applications of this project. There are many different ways in which it could be implemented, depending on the intended functionality, environment, components being used, and level of knowledge.</p><p>&nbsp;</p><h1>Limitations and potential risks<br></h1><p>There are some obvious limitations due to scale of the project and limited resources. Some potential risks need to be addressed during the implementation as well. Most important&nbsp;<span>of those are listed below:</span></p><p></p><ul><li>Water level sensor would have to be really long to cover at least half of the bath height. Most commercial ones that are available online are only a few centimetres long, so they will only track the water level and return any readings for a short period of time. For this reason, it is best to place the sensor near the top so that it will notify the user once the water raises near the desired level.</li><li>User will not be able to control the flow of the water from the application, as this would require much more sophisticated approach that involves integration with the bath and its taps. This is is beyond the scope of this project and capabilities of available hardware.<br></li><li>Android will be the only operating system that can be used to monitor the water level via mobile application. Neither HC-06 nor HC-05 Bluetooth modules are compatible with iOS devices, and mobile application that makes use of classes and methods described in the previous section can only be installed on Android smartphone or tablet. Targeting iOS devices would require entirely different approach both in terms of hardware components and software.</li><li>Using any kind of electronic device near water is always a danger and working with Arduino is no exception. Even though the water level sensor can be safely submerged, this is not the case with any other external component or the Arduino itself. This means that special caution has to be taken when testing the solution to minimize the risk of electric shock and/or damage to Arduino and its parts.</li><li>Basic, inexpensive water level sensors cannot be relied upon with a 100% confidence. For that reason, the sensor should not be placed at the very top of the bath and the bath should not be left unattended for longer period of time to prevent the risk of overflow, which would pose a serious risk.</li></ul><p></p><h1>Summary</h1>Ideas provided in this article are open to both modifications and extensions. The aim was to introduce the reader to the idea of monitoring water level in the bath, or some other container, using the sensor connected to Arduino Uno and a mobile device that acts as a user interface. Potential extensions may include using a longer sensor to cover more of the bath capacity or developing a mobile application that can be installed on both iOS and Android devices. Either way, it is a really interesting idea that has many potential applications beyond those suggested in this article, such as aquarium, water trough or even a vase. Whatever the choice, please be sure to thoroughly research the components being used, assemble them carefully and test rigorously before deploying your solution in a desired environment.</div>
</body>
</html>